# Notes for Demo ektvn Site

## Process for remove a feature (related services) after deployment

Scenarios:

- Deploy site with features: core, rideRegistration
- Want to turn off rideRegistration (remove services from Chart-Release)

Issues:

- even using rollback or apply new values with `tags: - rideRegistration: false`
  -> Services are still exists in K8s
  -> Have to remove resources manually
  -> need to check more on this

## MongoDB Deployment

```
NAME: mongodb
LAST DEPLOYED: Thu Jun 17 10:53:51 2021
NAMESPACE: ektvn
STATUS: deployed
REVISION: 1
TEST SUITE: None
NOTES:
** Please be patient while the chart is being deployed **

MongoDB(R) can be accessed on the following DNS name(s) and ports from within your cluster:

    mongodb.ektvn.svc.cluster.local

To connect to your database, create a MongoDB(R) client container:

    kubectl run --namespace ektvn mongodb-client --rm --tty -i --restart='Never' --env="MONGODB_ROOT_PASSWORD=$MONGODB_ROOT_PASSWORD" --image docker.io/bitnami/mongodb:4.4.6-debian-10-r8 --command -- bash

Then, run the following command:
    mongo admin --host "mongodb"

To connect to your database from outside the cluster execute the following commands:

    kubectl port-forward --namespace ektvn svc/mongodb 27017:27017 &
    mongo --host 127.0.0.1
```

## RabbitMQ Deployment

```
NAME: rabbitmq
LAST DEPLOYED: Thu Jun 17 11:38:07 2021
NAMESPACE: ektvn
STATUS: deployed
REVISION: 1
TEST SUITE: None
NOTES:
** Please be patient while the chart is being deployed **

Credentials:
    echo "Username      : edulog"
    echo "Password      : $(kubectl get secret --namespace ektvn rabbitmq -o jsonpath="{.data.rabbitmq-password}" | base64 --decode)"
    echo "ErLang Cookie : $(kubectl get secret --namespace ektvn rabbitmq -o jsonpath="{.data.rabbitmq-erlang-cookie}" | base64 --decode)"

Note that the credentials are saved in persistent volume claims and will not be changed upon upgrade or reinstallation unless the persistent volume claim has been deleted. If this is not the first installation of this chart, the credentials may not be valid.
This is applicable when no passwords are set and therefore the random password is autogenerated. In case of using a fixed password, you should specify it when upgrading.
More information about the credentials may be found at https://docs.bitnami.com/general/how-to/troubleshoot-helm-chart-issues/#credential-errors-while-upgrading-chart-releases.

RabbitMQ can be accessed within the cluster on port  at rabbitmq.ektvn.svc.

To access for outside the cluster, perform the following steps:

To Access the RabbitMQ AMQP port:

    echo "URL : amqp://127.0.0.1:5672/"
    kubectl port-forward --namespace ektvn svc/rabbitmq 5672:5672

To Access the RabbitMQ Management interface:

    echo "URL : http://127.0.0.1:15672/"
    kubectl port-forward --namespace ektvn svc/rabbitmq 15672:15672
```
